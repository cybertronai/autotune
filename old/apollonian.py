import opt_einsum as oe
import numpy as np
import re

apollonian2="{{1,2},{1,3},{1,4},{1,5},{1,6},{2,3},{2,4},{2,5},{2,7},{3,4},{3,6},{3,7},{4,5},{4,6},{4,7}}"
apollonian3="{{1,2},{1,3},{1,4},{1,5},{1,6},{1,8},{1,9},{1,11},{1,12},{2,3},{2,4},{2,5},{2,7},{2,8},{2,10},{2,14},{2,15},{3,4},{3,6},{3,7},{3,11},{3,13},{3,14},{3,16},{4,5},{4,6},{4,7},{4,9},{4,10},{4,12},{4,13},{4,15},{4,16},{5,8},{5,9},{5,10},{6,11},{6,12},{6,13},{7,14},{7,15},{7,16}}"
apollonian4="{{1,2},{1,3},{1,4},{1,5},{1,6},{1,8},{1,9},{1,11},{1,12},{1,17},{1,18},{1,20},{1,21},{1,26},{1,27},{1,29},{1,30},{2,3},{2,4},{2,5},{2,7},{2,8},{2,10},{2,14},{2,15},{2,17},{2,19},{2,23},{2,24},{2,35},{2,36},{2,38},{2,39},{3,4},{3,6},{3,7},{3,11},{3,13},{3,14},{3,16},{3,26},{3,28},{3,32},{3,33},{3,35},{3,37},{3,41},{3,42},{4,5},{4,6},{4,7},{4,9},{4,10},{4,12},{4,13},{4,15},{4,16},{4,20},{4,22},{4,23},{4,25},{4,29},{4,31},{4,32},{4,34},{4,38},{4,40},{4,41},{4,43},{5,8},{5,9},{5,10},{5,18},{5,19},{5,21},{5,22},{5,24},{5,25},{6,11},{6,12},{6,13},{6,27},{6,28},{6,30},{6,31},{6,33},{6,34},{7,14},{7,15},{7,16},{7,36},{7,37},{7,39},{7,40},{7,42},{7,43},{8,17},{8,18},{8,19},{9,20},{9,21},{9,22},{10,23},{10,24},{10,25},{11,26},{11,27},{11,28},{12,29},{12,30},{12,31},{13,32},{13,33},{13,34},{14,35},{14,36},{14,37},{15,38},{15,39},{15,40},{16,41},{16,42},{16,43}}"
apollonian5="{{1,2},{1,3},{1,4},{1,5},{1,6},{1,8},{1,9},{1,11},{1,12},{1,17},{1,18},{1,20},{1,21},{1,26},{1,27},{1,29},{1,30},{1,44},{1,45},{1,47},{1,48},{1,53},{1,54},{1,56},{1,57},{1,71},{1,72},{1,74},{1,75},{1,80},{1,81},{1,83},{1,84},{2,3},{2,4},{2,5},{2,7},{2,8},{2,10},{2,14},{2,15},{2,17},{2,19},{2,23},{2,24},{2,35},{2,36},{2,38},{2,39},{2,44},{2,46},{2,50},{2,51},{2,62},{2,63},{2,65},{2,66},{2,98},{2,99},{2,101},{2,102},{2,107},{2,108},{2,110},{2,111},{3,4},{3,6},{3,7},{3,11},{3,13},{3,14},{3,16},{3,26},{3,28},{3,32},{3,33},{3,35},{3,37},{3,41},{3,42},{3,71},{3,73},{3,77},{3,78},{3,89},{3,90},{3,92},{3,93},{3,98},{3,100},{3,104},{3,105},{3,116},{3,117},{3,119},{3,120},{4,5},{4,6},{4,7},{4,9},{4,10},{4,12},{4,13},{4,15},{4,16},{4,20},{4,22},{4,23},{4,25},{4,29},{4,31},{4,32},{4,34},{4,38},{4,40},{4,41},{4,43},{4,53},{4,55},{4,59},{4,60},{4,62},{4,64},{4,68},{4,69},{4,80},{4,82},{4,86},{4,87},{4,89},{4,91},{4,95},{4,96},{4,107},{4,109},{4,113},{4,114},{4,116},{4,118},{4,122},{4,123},{5,8},{5,9},{5,10},{5,18},{5,19},{5,21},{5,22},{5,24},{5,25},{5,47},{5,49},{5,50},{5,52},{5,56},{5,58},{5,59},{5,61},{5,65},{5,67},{5,68},{5,70},{6,11},{6,12},{6,13},{6,27},{6,28},{6,30},{6,31},{6,33},{6,34},{6,74},{6,76},{6,77},{6,79},{6,83},{6,85},{6,86},{6,88},{6,92},{6,94},{6,95},{6,97},{7,14},{7,15},{7,16},{7,36},{7,37},{7,39},{7,40},{7,42},{7,43},{7,101},{7,103},{7,104},{7,106},{7,110},{7,112},{7,113},{7,115},{7,119},{7,121},{7,122},{7,124},{8,17},{8,18},{8,19},{8,45},{8,46},{8,48},{8,49},{8,51},{8,52},{9,20},{9,21},{9,22},{9,54},{9,55},{9,57},{9,58},{9,60},{9,61},{10,23},{10,24},{10,25},{10,63},{10,64},{10,66},{10,67},{10,69},{10,70},{11,26},{11,27},{11,28},{11,72},{11,73},{11,75},{11,76},{11,78},{11,79},{12,29},{12,30},{12,31},{12,81},{12,82},{12,84},{12,85},{12,87},{12,88},{13,32},{13,33},{13,34},{13,90},{13,91},{13,93},{13,94},{13,96},{13,97},{14,35},{14,36},{14,37},{14,99},{14,100},{14,102},{14,103},{14,105},{14,106},{15,38},{15,39},{15,40},{15,108},{15,109},{15,111},{15,112},{15,114},{15,115},{16,41},{16,42},{16,43},{16,117},{16,118},{16,120},{16,121},{16,123},{16,124},{17,44},{17,45},{17,46},{18,47},{18,48},{18,49},{19,50},{19,51},{19,52},{20,53},{20,54},{20,55},{21,56},{21,57},{21,58},{22,59},{22,60},{22,61},{23,62},{23,63},{23,64},{24,65},{24,66},{24,67},{25,68},{25,69},{25,70},{26,71},{26,72},{26,73},{27,74},{27,75},{27,76},{28,77},{28,78},{28,79},{29,80},{29,81},{29,82},{30,83},{30,84},{30,85},{31,86},{31,87},{31,88},{32,89},{32,90},{32,91},{33,92},{33,93},{33,94},{34,95},{34,96},{34,97},{35,98},{35,99},{35,100},{36,101},{36,102},{36,103},{37,104},{37,105},{37,106},{38,107},{38,108},{38,109},{39,110},{39,111},{39,112},{40,113},{40,114},{40,115},{41,116},{41,117},{41,118},{42,119},{42,120},{42,121},{43,122},{43,123},{43,124}}"
apollonian6="{{1,2},{1,3},{1,4},{1,5},{1,6},{1,8},{1,9},{1,11},{1,12},{1,17},{1,18},{1,20},{1,21},{1,26},{1,27},{1,29},{1,30},{1,44},{1,45},{1,47},{1,48},{1,53},{1,54},{1,56},{1,57},{1,71},{1,72},{1,74},{1,75},{1,80},{1,81},{1,83},{1,84},{1,125},{1,126},{1,128},{1,129},{1,134},{1,135},{1,137},{1,138},{1,152},{1,153},{1,155},{1,156},{1,161},{1,162},{1,164},{1,165},{1,206},{1,207},{1,209},{1,210},{1,215},{1,216},{1,218},{1,219},{1,233},{1,234},{1,236},{1,237},{1,242},{1,243},{1,245},{1,246},{2,3},{2,4},{2,5},{2,7},{2,8},{2,10},{2,14},{2,15},{2,17},{2,19},{2,23},{2,24},{2,35},{2,36},{2,38},{2,39},{2,44},{2,46},{2,50},{2,51},{2,62},{2,63},{2,65},{2,66},{2,98},{2,99},{2,101},{2,102},{2,107},{2,108},{2,110},{2,111},{2,125},{2,127},{2,131},{2,132},{2,143},{2,144},{2,146},{2,147},{2,179},{2,180},{2,182},{2,183},{2,188},{2,189},{2,191},{2,192},{2,287},{2,288},{2,290},{2,291},{2,296},{2,297},{2,299},{2,300},{2,314},{2,315},{2,317},{2,318},{2,323},{2,324},{2,326},{2,327},{3,4},{3,6},{3,7},{3,11},{3,13},{3,14},{3,16},{3,26},{3,28},{3,32},{3,33},{3,35},{3,37},{3,41},{3,42},{3,71},{3,73},{3,77},{3,78},{3,89},{3,90},{3,92},{3,93},{3,98},{3,100},{3,104},{3,105},{3,116},{3,117},{3,119},{3,120},{3,206},{3,208},{3,212},{3,213},{3,224},{3,225},{3,227},{3,228},{3,260},{3,261},{3,263},{3,264},{3,269},{3,270},{3,272},{3,273},{3,287},{3,289},{3,293},{3,294},{3,305},{3,306},{3,308},{3,309},{3,341},{3,342},{3,344},{3,345},{3,350},{3,351},{3,353},{3,354},{4,5},{4,6},{4,7},{4,9},{4,10},{4,12},{4,13},{4,15},{4,16},{4,20},{4,22},{4,23},{4,25},{4,29},{4,31},{4,32},{4,34},{4,38},{4,40},{4,41},{4,43},{4,53},{4,55},{4,59},{4,60},{4,62},{4,64},{4,68},{4,69},{4,80},{4,82},{4,86},{4,87},{4,89},{4,91},{4,95},{4,96},{4,107},{4,109},{4,113},{4,114},{4,116},{4,118},{4,122},{4,123},{4,152},{4,154},{4,158},{4,159},{4,170},{4,171},{4,173},{4,174},{4,179},{4,181},{4,185},{4,186},{4,197},{4,198},{4,200},{4,201},{4,233},{4,235},{4,239},{4,240},{4,251},{4,252},{4,254},{4,255},{4,260},{4,262},{4,266},{4,267},{4,278},{4,279},{4,281},{4,282},{4,314},{4,316},{4,320},{4,321},{4,332},{4,333},{4,335},{4,336},{4,341},{4,343},{4,347},{4,348},{4,359},{4,360},{4,362},{4,363},{5,8},{5,9},{5,10},{5,18},{5,19},{5,21},{5,22},{5,24},{5,25},{5,47},{5,49},{5,50},{5,52},{5,56},{5,58},{5,59},{5,61},{5,65},{5,67},{5,68},{5,70},{5,134},{5,136},{5,140},{5,141},{5,143},{5,145},{5,149},{5,150},{5,161},{5,163},{5,167},{5,168},{5,170},{5,172},{5,176},{5,177},{5,188},{5,190},{5,194},{5,195},{5,197},{5,199},{5,203},{5,204},{6,11},{6,12},{6,13},{6,27},{6,28},{6,30},{6,31},{6,33},{6,34},{6,74},{6,76},{6,77},{6,79},{6,83},{6,85},{6,86},{6,88},{6,92},{6,94},{6,95},{6,97},{6,215},{6,217},{6,221},{6,222},{6,224},{6,226},{6,230},{6,231},{6,242},{6,244},{6,248},{6,249},{6,251},{6,253},{6,257},{6,258},{6,269},{6,271},{6,275},{6,276},{6,278},{6,280},{6,284},{6,285},{7,14},{7,15},{7,16},{7,36},{7,37},{7,39},{7,40},{7,42},{7,43},{7,101},{7,103},{7,104},{7,106},{7,110},{7,112},{7,113},{7,115},{7,119},{7,121},{7,122},{7,124},{7,296},{7,298},{7,302},{7,303},{7,305},{7,307},{7,311},{7,312},{7,323},{7,325},{7,329},{7,330},{7,332},{7,334},{7,338},{7,339},{7,350},{7,352},{7,356},{7,357},{7,359},{7,361},{7,365},{7,366},{8,17},{8,18},{8,19},{8,45},{8,46},{8,48},{8,49},{8,51},{8,52},{8,128},{8,130},{8,131},{8,133},{8,137},{8,139},{8,140},{8,142},{8,146},{8,148},{8,149},{8,151},{9,20},{9,21},{9,22},{9,54},{9,55},{9,57},{9,58},{9,60},{9,61},{9,155},{9,157},{9,158},{9,160},{9,164},{9,166},{9,167},{9,169},{9,173},{9,175},{9,176},{9,178},{10,23},{10,24},{10,25},{10,63},{10,64},{10,66},{10,67},{10,69},{10,70},{10,182},{10,184},{10,185},{10,187},{10,191},{10,193},{10,194},{10,196},{10,200},{10,202},{10,203},{10,205},{11,26},{11,27},{11,28},{11,72},{11,73},{11,75},{11,76},{11,78},{11,79},{11,209},{11,211},{11,212},{11,214},{11,218},{11,220},{11,221},{11,223},{11,227},{11,229},{11,230},{11,232},{12,29},{12,30},{12,31},{12,81},{12,82},{12,84},{12,85},{12,87},{12,88},{12,236},{12,238},{12,239},{12,241},{12,245},{12,247},{12,248},{12,250},{12,254},{12,256},{12,257},{12,259},{13,32},{13,33},{13,34},{13,90},{13,91},{13,93},{13,94},{13,96},{13,97},{13,263},{13,265},{13,266},{13,268},{13,272},{13,274},{13,275},{13,277},{13,281},{13,283},{13,284},{13,286},{14,35},{14,36},{14,37},{14,99},{14,100},{14,102},{14,103},{14,105},{14,106},{14,290},{14,292},{14,293},{14,295},{14,299},{14,301},{14,302},{14,304},{14,308},{14,310},{14,311},{14,313},{15,38},{15,39},{15,40},{15,108},{15,109},{15,111},{15,112},{15,114},{15,115},{15,317},{15,319},{15,320},{15,322},{15,326},{15,328},{15,329},{15,331},{15,335},{15,337},{15,338},{15,340},{16,41},{16,42},{16,43},{16,117},{16,118},{16,120},{16,121},{16,123},{16,124},{16,344},{16,346},{16,347},{16,349},{16,353},{16,355},{16,356},{16,358},{16,362},{16,364},{16,365},{16,367},{17,44},{17,45},{17,46},{17,126},{17,127},{17,129},{17,130},{17,132},{17,133},{18,47},{18,48},{18,49},{18,135},{18,136},{18,138},{18,139},{18,141},{18,142},{19,50},{19,51},{19,52},{19,144},{19,145},{19,147},{19,148},{19,150},{19,151},{20,53},{20,54},{20,55},{20,153},{20,154},{20,156},{20,157},{20,159},{20,160},{21,56},{21,57},{21,58},{21,162},{21,163},{21,165},{21,166},{21,168},{21,169},{22,59},{22,60},{22,61},{22,171},{22,172},{22,174},{22,175},{22,177},{22,178},{23,62},{23,63},{23,64},{23,180},{23,181},{23,183},{23,184},{23,186},{23,187},{24,65},{24,66},{24,67},{24,189},{24,190},{24,192},{24,193},{24,195},{24,196},{25,68},{25,69},{25,70},{25,198},{25,199},{25,201},{25,202},{25,204},{25,205},{26,71},{26,72},{26,73},{26,207},{26,208},{26,210},{26,211},{26,213},{26,214},{27,74},{27,75},{27,76},{27,216},{27,217},{27,219},{27,220},{27,222},{27,223},{28,77},{28,78},{28,79},{28,225},{28,226},{28,228},{28,229},{28,231},{28,232},{29,80},{29,81},{29,82},{29,234},{29,235},{29,237},{29,238},{29,240},{29,241},{30,83},{30,84},{30,85},{30,243},{30,244},{30,246},{30,247},{30,249},{30,250},{31,86},{31,87},{31,88},{31,252},{31,253},{31,255},{31,256},{31,258},{31,259},{32,89},{32,90},{32,91},{32,261},{32,262},{32,264},{32,265},{32,267},{32,268},{33,92},{33,93},{33,94},{33,270},{33,271},{33,273},{33,274},{33,276},{33,277},{34,95},{34,96},{34,97},{34,279},{34,280},{34,282},{34,283},{34,285},{34,286},{35,98},{35,99},{35,100},{35,288},{35,289},{35,291},{35,292},{35,294},{35,295},{36,101},{36,102},{36,103},{36,297},{36,298},{36,300},{36,301},{36,303},{36,304},{37,104},{37,105},{37,106},{37,306},{37,307},{37,309},{37,310},{37,312},{37,313},{38,107},{38,108},{38,109},{38,315},{38,316},{38,318},{38,319},{38,321},{38,322},{39,110},{39,111},{39,112},{39,324},{39,325},{39,327},{39,328},{39,330},{39,331},{40,113},{40,114},{40,115},{40,333},{40,334},{40,336},{40,337},{40,339},{40,340},{41,116},{41,117},{41,118},{41,342},{41,343},{41,345},{41,346},{41,348},{41,349},{42,119},{42,120},{42,121},{42,351},{42,352},{42,354},{42,355},{42,357},{42,358},{43,122},{43,123},{43,124},{43,360},{43,361},{43,363},{43,364},{43,366},{43,367},{44,125},{44,126},{44,127},{45,128},{45,129},{45,130},{46,131},{46,132},{46,133},{47,134},{47,135},{47,136},{48,137},{48,138},{48,139},{49,140},{49,141},{49,142},{50,143},{50,144},{50,145},{51,146},{51,147},{51,148},{52,149},{52,150},{52,151},{53,152},{53,153},{53,154},{54,155},{54,156},{54,157},{55,158},{55,159},{55,160},{56,161},{56,162},{56,163},{57,164},{57,165},{57,166},{58,167},{58,168},{58,169},{59,170},{59,171},{59,172},{60,173},{60,174},{60,175},{61,176},{61,177},{61,178},{62,179},{62,180},{62,181},{63,182},{63,183},{63,184},{64,185},{64,186},{64,187},{65,188},{65,189},{65,190},{66,191},{66,192},{66,193},{67,194},{67,195},{67,196},{68,197},{68,198},{68,199},{69,200},{69,201},{69,202},{70,203},{70,204},{70,205},{71,206},{71,207},{71,208},{72,209},{72,210},{72,211},{73,212},{73,213},{73,214},{74,215},{74,216},{74,217},{75,218},{75,219},{75,220},{76,221},{76,222},{76,223},{77,224},{77,225},{77,226},{78,227},{78,228},{78,229},{79,230},{79,231},{79,232},{80,233},{80,234},{80,235},{81,236},{81,237},{81,238},{82,239},{82,240},{82,241},{83,242},{83,243},{83,244},{84,245},{84,246},{84,247},{85,248},{85,249},{85,250},{86,251},{86,252},{86,253},{87,254},{87,255},{87,256},{88,257},{88,258},{88,259},{89,260},{89,261},{89,262},{90,263},{90,264},{90,265},{91,266},{91,267},{91,268},{92,269},{92,270},{92,271},{93,272},{93,273},{93,274},{94,275},{94,276},{94,277},{95,278},{95,279},{95,280},{96,281},{96,282},{96,283},{97,284},{97,285},{97,286},{98,287},{98,288},{98,289},{99,290},{99,291},{99,292},{100,293},{100,294},{100,295},{101,296},{101,297},{101,298},{102,299},{102,300},{102,301},{103,302},{103,303},{103,304},{104,305},{104,306},{104,307},{105,308},{105,309},{105,310},{106,311},{106,312},{106,313},{107,314},{107,315},{107,316},{108,317},{108,318},{108,319},{109,320},{109,321},{109,322},{110,323},{110,324},{110,325},{111,326},{111,327},{111,328},{112,329},{112,330},{112,331},{113,332},{113,333},{113,334},{114,335},{114,336},{114,337},{115,338},{115,339},{115,340},{116,341},{116,342},{116,343},{117,344},{117,345},{117,346},{118,347},{118,348},{118,349},{119,350},{119,351},{119,352},{120,353},{120,354},{120,355},{121,356},{121,357},{121,358},{122,359},{122,360},{122,361},{123,362},{123,363},{123,364},{124,365},{124,366},{124,367}}"
def tc(num):return chr(num+100000) if chr(num) in ' ,->.' else chr(num+65)
def factor(first, second): return tc(int(first))+tc(int(second))
def reduce(graph, optimize='auto'):
    factors=[factor(first,second) for first,second in re.findall("\{(\d+),(\d+)\}", graph)]
    expr=','.join(factors)+'->'
    print(oe.contract_path(','.join(factors)+'->', *[np.ones((100,100))]*len(factors),optimize=optimize))

reduce(apollonian6)
